---
interface Props {
  class?: string
  height?: string
}

const { class: className, height = '25rem' } = Astro.props
import '@styles/components/carousel.css'
---

<div 
  class={`carousel-container ${className || ''}`}
  style={`--carousel-height: ${height};`}
  x-data="{ 
    modalImgSrc: '',
    modalImgAlt: '',
    scrollNext() { 
      const track = this.$refs.track;
      track.scrollBy({ left: track.clientWidth * 0.8, behavior: 'smooth' });
    },
    scrollPrev() { 
      const track = this.$refs.track;
      track.scrollBy({ left: -track.clientWidth * 0.8, behavior: 'smooth' });
    },
    openModal(e) {
      if (e.target.tagName !== 'IMG') return;
      this.modalImgSrc = e.target.src;
      this.modalImgAlt = e.target.alt;
      this.$refs.lightbox.showPopover();
    }
  }"
>
  <div class="carousel-track" x-ref="track" @click="openModal">
    <slot />
  </div>
  
  <div class="carousel-nav">
    <button class="nav-btn prev" @click="scrollPrev" aria-label="Previous items">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg>
    </button>
    <button class="nav-btn next" @click="scrollNext" aria-label="Next items">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg>
    </button>
  </div>

  <div id="carousel-lightbox" class="lightbox-popover" popover x-ref="lightbox">
    <img :src="modalImgSrc" :alt="modalImgAlt" />
    <button class="close-btn" @click="$refs.lightbox.hidePopover()" aria-label="Close modal">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18M6 6l12 12"/></svg>
    </button>
  </div>
</div>
