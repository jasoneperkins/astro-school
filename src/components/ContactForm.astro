---
import {actions} from 'astro:actions'

import '@styles/components/contactForm.css'

interface Props {
  formTitle?: string
  context?: string
  submitText?: string
}

const {
  formTitle = 'Contact Us',
  context = 'General',
  submitText = 'Contact Us'
} = Astro.props
---

<div class="contact-container" x-data="contactHandler">
  <template x-if="state === 'success'">
    <div
      class="success-state animate-fade-in rounded-lg border-2 border-green-200 bg-green-50 p-6 text-center">
      <h3 class="text-xl font-bold text-green-800">Message Sent!</h3>
      <p class="mt-2 text-green-700">
        Shalom! Your message has been sent to Miss Cindy. We'll be in touch
        soon.
      </p>
    </div>
  </template>

  <template x-if="state !== 'success'">
    <div class="form-wrapper">
      <h3 class="mb-4 text-center text-2xl font-semibold md:text-left">
        {formTitle}
      </h3>

      <form
        @submit.prevent="submitForm"
        class="contactForm grid grid-cols-1 gap-y-4">
        <input type="hidden" name="sourceContext" value={context} />

        <div>
          <label for="parentName" class="block text-sm font-medium">
            Parent Name
          </label>
          <input
            type="text"
            id="parentName"
            name="parentName"
            class="form-input mt-1 block w-full rounded-md border-gray-300"
            required
          />
        </div>

        <div>
          <label for="email">
            Email Address
          </label>
          <input
            type="email"
            id="email"
            name="email"
            required
          />
        </div>

        <div class="col-span-full">
          <label for="message">
            Your Message
          </label>
          <textarea
            id="message"
            name="message"
            rows="4"
            class="form-textarea mt-1 block w-full rounded-md border-gray-300"
            required>
          </textarea>
        </div>

        <button
          type="submit"
          class="submit-btn w-full rounded-md bg-blue-600 py-3 text-white transition-opacity disabled:opacity-50"
          :disabled="state === 'loading'">
          <span x-show="state !== 'loading'">{submitText}</span>
          <span x-show="state === 'loading'" x-cloak>
            Sending to Miss Cindy...
          </span>
        </button>

        <p
          x-show="state === 'error'"
          class="mt-2 text-center text-sm text-red-600"
          x-cloak>Something went wrong. Please try again or call the office.
        </p>
      </form>
    </div>
  </template>
</div>

<script>
  import {contactHandler} from '@logic/contactHandler'

  document.addEventListener('alpine:init', () => {
    // @ts-ignore
    Alpine.data('contactHandler', contactHandler)
  })
</script>
